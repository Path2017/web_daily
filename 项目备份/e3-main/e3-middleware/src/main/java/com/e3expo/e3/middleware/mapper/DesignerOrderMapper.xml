<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.e3expo.e3.middleware.mapper.DesignerOrderMapper" >


  <select id="selectDesignerBiddingPrice" resultType="orderDesignerPrice">
    SELECT
    a.node_id,
    a.price,
    a.order_id,
    a.type,
    a.designer_id
    FROM
    te_order_designer_price AS a
    WHERE
    a.order_id = #{orderId}
  </select>

  <select id="selectWebViewByOrderId" resultType="webAppOrderDesignerView">
    SELECT
    b.mobile,
    b.working_years,
    c.`name` AS city,
    b.`name`
    FROM
    te_designer_order AS a
    LEFT JOIN te_user AS b ON a.designer_id = b.id
    LEFT JOIN dic_city AS c ON b.city_id = c.id
    WHERE
    a.order_id = #{orderId} AND
    a.is_valid = 1
  </select>

  <select id="selectByOrderId" resultType="designerOrder">
    SELECT * FROM te_designer_order WHERE order_id = #{orderId}
  </select>


  <update id="updateNodeIdByOrderId">
    UPDATE te_designer_order SET node_id = #{nodeId}, update_time = #{updateTime}
    WHERE order_id = #{orderId}
  </update>
  <resultMap id="BaseResultMap" type="com.e3expo.e3.model.DesignerOrder" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 07 16:26:13 CST 2017.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="order_id" property="orderId" jdbcType="INTEGER" />
    <result column="designer_id" property="designerId" jdbcType="INTEGER" />
    <result column="designer_name" property="designerName" jdbcType="VARCHAR" />
    <result column="designer_type" property="designerType" jdbcType="VARCHAR" />
    <result column="designer_level" property="designerLevel" jdbcType="VARCHAR" />
    <result column="designer_phone" property="designerPhone" jdbcType="VARCHAR" />
    <result column="design_qq" property="designQq" jdbcType="VARCHAR" />
    <result column="is_valid" property="isValid" jdbcType="INTEGER" />
    <result column="pid" property="pid" jdbcType="INTEGER" />
    <result column="audit_status" property="auditStatus" jdbcType="INTEGER" />
    <result column="is_lock" property="isLock" jdbcType="INTEGER" />
    <result column="node_id" property="nodeId" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="BIGINT" />
    <result column="update_time" property="updateTime" jdbcType="BIGINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 07 16:26:13 CST 2017.
    -->
    id, order_id, designer_id, designer_name, designer_type, designer_level, designer_phone, 
    design_qq, is_valid, pid, audit_status, is_lock, node_id, create_time, update_time
  </sql>
  
  
  <!-- 查看当前设计师手中有几个正在进行的订单 -->
  <select id="selectCountOrderingDesigner" resultType="int">
  	select count(1)
  	from te_disginer_order a
  	inner join te_order b on a.order_id = b.id 
  	where a.is_valid = 0 and b.status in (1,2)
  	and a.disginer_id = #{desiginerId} b.node_id = a.node_id and b.node_id != '99'
  </select>
  
  <!-- 添加设计师可抢单列表 -->
  <insert id="insertDesignerLinkOrder">
  	insert into tr_designer_order
  	(order_id,designer_id)
  	values
  	<if test="list != null and list.size>0">
  		<foreach collection="list" index="index" item="item" separator=",">
  		(#{item.orderId},#{item.designerId})
  		</foreach>
  	</if>
  </insert>

	<!-- 查询当前设计师可抢单列表 -->
	<select id="selectSingleOrderListByDesignerId"  resultType="orderModel">
		select c.rfp_no,a.order_id,b.create_time,c.company_name,
		c.booth_width,c.booth_length,c.exhibitor_name,c.budget,
		e.first_design_price,e.detailed_design_price,e.construction_drawing_price
		from tr_designer_order a inner join te_order b on a.order_id = b.id
		inner join te_rfp c on b.rfp_id = c.id
		inner join te_rfp_detail d on c.id = d.rfp_id
		inner join te_designer_need e on c.id = e.rfp_id
		where a.designer_id = #{designerId}
		order by b.create_time limit #{offset},#{limit} 
	</select>
	
	<!-- 查询正在进行的订单 -->
	<select id="selectOrderListByDesignerId"  resultType="orderModel">
		select c.rfp_no,a.order_id,b.create_time,c.company_name,
		c.booth_width,c.booth_length,c.exhibitor_name,c.budget,
		e.first_design_price,e.detailed_design_price,e.construction_drawing_price
		from te_designer_order a inner join te_order b on a.order_id = b.id
		inner join te_rfp c on b.rfp_id = c.id
		inner join te_rfp_detail d on c.id = d.rfp_id
		inner join te_designer_need e on c.id = e.rfp_id
		where a.designer_id = #{designerId}
		and a.is_valid = 1 and a.node_id = b.node_id
		and b.status = 1 and b.node_id != '99'
		order by b.create_time limit #{offset},#{limit} 
	</select>
	
	<!-- 查询已完成的订单 -->
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 07 16:26:13 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from te_designer_order
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 07 16:26:13 CST 2017.
    -->
    delete from te_designer_order
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.e3expo.e3.model.DesignerOrder" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 07 16:26:13 CST 2017.
    -->
    insert into te_designer_order (id, order_id, designer_id, 
      designer_name, designer_type, designer_level, 
      designer_phone, design_qq, is_valid, 
      pid, audit_status, is_lock, 
      node_id, create_time, update_time
      )
    values (#{id,jdbcType=INTEGER}, #{orderId,jdbcType=INTEGER}, #{designerId,jdbcType=INTEGER}, 
      #{designerName,jdbcType=VARCHAR}, #{designerType,jdbcType=VARCHAR}, #{designerLevel,jdbcType=VARCHAR}, 
      #{designerPhone,jdbcType=VARCHAR}, #{designQq,jdbcType=VARCHAR}, #{isValid,jdbcType=INTEGER}, 
      #{pid,jdbcType=INTEGER}, #{auditStatus,jdbcType=INTEGER}, #{isLock,jdbcType=INTEGER}, 
      #{nodeId,jdbcType=INTEGER}, #{createTime,jdbcType=BIGINT}, #{updateTime,jdbcType=BIGINT}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.e3expo.e3.model.DesignerOrder" >

    insert into te_designer_order
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="orderId != null" >
        order_id,
      </if>
      <if test="designerId != null" >
        designer_id,
      </if>
      <if test="designerName != null" >
        designer_name,
      </if>
      <if test="designerType != null" >
        designer_type,
      </if>
      <if test="designerLevel != null" >
        designer_level,
      </if>
      <if test="designerPhone != null" >
        designer_phone,
      </if>
      <if test="designQq != null" >
        design_qq,
      </if>
      <if test="isValid != null" >
        is_valid,
      </if>
      <if test="pid != null" >
        pid,
      </if>
      <if test="auditStatus != null" >
        audit_status,
      </if>
      <if test="isLock != null" >
        is_lock,
      </if>
      <if test="nodeId != null" >
        node_id,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="updateTime != null" >
        update_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="orderId != null" >
        #{orderId,jdbcType=INTEGER},
      </if>
      <if test="designerId != null" >
        #{designerId,jdbcType=INTEGER},
      </if>
      <if test="designerName != null" >
        #{designerName,jdbcType=VARCHAR},
      </if>
      <if test="designerType != null" >
        #{designerType,jdbcType=VARCHAR},
      </if>
      <if test="designerLevel != null" >
        #{designerLevel,jdbcType=VARCHAR},
      </if>
      <if test="designerPhone != null" >
        #{designerPhone,jdbcType=VARCHAR},
      </if>
      <if test="designQq != null" >
        #{designQq,jdbcType=VARCHAR},
      </if>
      <if test="isValid != null" >
        #{isValid,jdbcType=INTEGER},
      </if>
      <if test="pid != null" >
        #{pid,jdbcType=INTEGER},
      </if>
      <if test="auditStatus != null" >
        #{auditStatus,jdbcType=INTEGER},
      </if>
      <if test="isLock != null" >
        #{isLock,jdbcType=INTEGER},
      </if>
      <if test="nodeId != null" >
        #{nodeId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=BIGINT},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.e3expo.e3.model.DesignerOrder" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 07 16:26:13 CST 2017.
    -->
    update te_designer_order
    <set >
      <if test="orderId != null" >
        order_id = #{orderId,jdbcType=INTEGER},
      </if>
      <if test="designerId != null" >
        designer_id = #{designerId,jdbcType=INTEGER},
      </if>
      <if test="designerName != null" >
        designer_name = #{designerName,jdbcType=VARCHAR},
      </if>
      <if test="designerType != null" >
        designer_type = #{designerType,jdbcType=VARCHAR},
      </if>
      <if test="designerLevel != null" >
        designer_level = #{designerLevel,jdbcType=VARCHAR},
      </if>
      <if test="designerPhone != null" >
        designer_phone = #{designerPhone,jdbcType=VARCHAR},
      </if>
      <if test="designQq != null" >
        design_qq = #{designQq,jdbcType=VARCHAR},
      </if>
      <if test="isValid != null" >
        is_valid = #{isValid,jdbcType=INTEGER},
      </if>
      <if test="pid != null" >
        pid = #{pid,jdbcType=INTEGER},
      </if>
      <if test="auditStatus != null" >
        audit_status = #{auditStatus,jdbcType=INTEGER},
      </if>
      <if test="isLock != null" >
        is_lock = #{isLock,jdbcType=INTEGER},
      </if>
      <if test="nodeId != null" >
        node_id = #{nodeId,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=BIGINT},
      </if>
      <if test="updateTime != null" >
        update_time = #{updateTime,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.e3expo.e3.model.DesignerOrder" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Nov 07 16:26:13 CST 2017.
    -->
    update te_designer_order
    set order_id = #{orderId,jdbcType=INTEGER},
      designer_id = #{designerId,jdbcType=INTEGER},
      designer_name = #{designerName,jdbcType=VARCHAR},
      designer_type = #{designerType,jdbcType=VARCHAR},
      designer_level = #{designerLevel,jdbcType=VARCHAR},
      designer_phone = #{designerPhone,jdbcType=VARCHAR},
      design_qq = #{designQq,jdbcType=VARCHAR},
      is_valid = #{isValid,jdbcType=INTEGER},
      pid = #{pid,jdbcType=INTEGER},
      audit_status = #{auditStatus,jdbcType=INTEGER},
      is_lock = #{isLock,jdbcType=INTEGER},
      node_id = #{nodeId,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=BIGINT},
      update_time = #{updateTime,jdbcType=BIGINT}
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>