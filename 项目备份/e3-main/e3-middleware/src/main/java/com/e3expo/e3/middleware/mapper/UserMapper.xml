<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.e3expo.e3.middleware.mapper.UserMapper">


	<select id="listDesignerWorkingYearsSplitPoint" resultType="int">
		select split_point FROM dic_designer_working_years
	</select>
	<!-- <id column="id" property="id" jdbcType="INTEGER" /> <result column="job_number" 
		property="jobNumber" jdbcType="VARCHAR" /> <result column="mobile" property="mobile" 
		jdbcType="VARCHAR" /> <result column="password" property="password" jdbcType="VARCHAR" 
		/> <result column="email" property="email" jdbcType="VARCHAR" /> <result 
		column="create_time" property="createTime" jdbcType="BIGINT" /> <result column="status" 
		property="status" jdbcType="INTEGER" /> <result column="is_valid" property="isValid" 
		jdbcType="INTEGER" /> <result column="update_time" property="updateTime" 
		jdbcType="BIGINT" /> <result column="user_type" property="userType" jdbcType="INTEGER" 
		/> <result column="qq" property="qq" jdbcType="VARCHAR" /> <result column="province_id" 
		property="provinceId" jdbcType="INTEGER" /> <result column="city_id" property="cityId" 
		jdbcType="INTEGER" /> <result column="bank_account" property="bankAccount" 
		jdbcType="VARCHAR" /> <result column="bank_user_name" property="bankUserName" 
		jdbcType="VARCHAR" /> <result column="bank_id" property="bankId" jdbcType="INTEGER" 
		/> <result column="company_name" property="companyName" jdbcType="VARCHAR" 
		/> <result column="logo_url" property="logoUrl" jdbcType="VARCHAR" /> </resultMap> -->
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Tue Nov 07 
			16:26:13 CST 2017. -->
		id, job_number, mobile, password, email, create_time, status,
		is_valid, update_time,
		user_type, qq, province_id, city_id,
		bank_account, bank_user_name, bank_id,
		company_name,
		logo_url
	</sql>

	<!-- 查询用户信息 -->
	<select id="queryUserInfoByMobile" resultType="User">
		select * from
		te_user where mobile = #{mobile} and is_valid=1
	</select>
	<!-- 新增展装公司 -->
	<insert id="insertExhibitor">
		insert into te_user (job_number, mobile, password,
		create_time, status,
		is_valid, update_time, user_type,company_name)
		values(#{jobNumber},#{mobile},#{password},#{createTime},#{status},#{isValid},#{updateTime},#{userType},#{companyName})
	</insert>

	<select id="selectByPrimaryKey" resultType="user" parameterType="java.lang.Integer">
		select
		<include refid="Base_Column_List" />
		from te_user
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		delete from
		te_user
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert">
		insert into te_user (id, job_number, mobile,
		password, email, create_time,
		status, is_valid, update_time,
		user_type,
		qq, province_id,
		city_id, bank_account, bank_user_name,
		bank_id,
		company_name, logo_url
		)
		values (#{id,jdbcType=INTEGER},
		#{jobNumber,jdbcType=VARCHAR},
		#{mobile,jdbcType=VARCHAR},
		#{password,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR},
		#{createTime,jdbcType=BIGINT},
		#{status,jdbcType=INTEGER},
		#{isValid,jdbcType=INTEGER},
		#{updateTime,jdbcType=BIGINT},
		#{userType,jdbcType=INTEGER}, #{qq,jdbcType=VARCHAR},
		#{provinceId,jdbcType=INTEGER},
		#{cityId,jdbcType=INTEGER},
		#{bankAccount,jdbcType=VARCHAR},
		#{bankUserName,jdbcType=VARCHAR},
		#{bankId,jdbcType=INTEGER}, #{companyName,jdbcType=VARCHAR},
		#{logoUrl,jdbcType=VARCHAR}
		)
	</insert>
	<insert id="insertSelective" parameterType="user"
		useGeneratedKeys="true" keyProperty="id">
		insert into te_user
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="jobNumber != null">
				job_number,
			</if>
			<if test="mobile != null">
				mobile,
			</if>
			<if test="password != null">
				password,
			</if>
			<if test="email != null">
				email,
			</if>
			<if test="createTime != null">
				create_time,
			</if>
			<if test="status != null">
				status,
			</if>
			<if test="isValid != null">
				is_valid,
			</if>
			<if test="updateTime != null">
				update_time,
			</if>
			<if test="userType != null">
				user_type,
			</if>
			<if test="qq != null">
				qq,
			</if>
			<if test="provinceId != null">
				province_id,
			</if>
			<if test="cityId != null">
				city_id,
			</if>
			<if test="bankAccount != null">
				bank_account,
			</if>
			<if test="bankUserName != null">
				bank_user_name,
			</if>
			<if test="bankName != null">
				bank_name,
			</if>
			<if test="bankBranchName != null">
				bank_branch_name,
			</if>
			<if test="companyName != null">
				company_name,
			</if>
			<if test="logoUrl != null">
				logo_url,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="jobNumber != null">
				#{jobNumber,jdbcType=VARCHAR},
			</if>
			<if test="mobile != null">
				#{mobile,jdbcType=VARCHAR},
			</if>
			<if test="password != null">
				#{password,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				#{email,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				#{createTime,jdbcType=BIGINT},
			</if>
			<if test="status != null">
				#{status,jdbcType=INTEGER},
			</if>
			<if test="isValid != null">
				#{isValid,jdbcType=INTEGER},
			</if>
			<if test="updateTime != null">
				#{updateTime,jdbcType=BIGINT},
			</if>
			<if test="userType != null">
				#{userType,jdbcType=INTEGER},
			</if>
			<if test="qq != null">
				#{qq,jdbcType=VARCHAR},
			</if>
			<if test="provinceId != null">
				#{provinceId,jdbcType=INTEGER},
			</if>
			<if test="cityId != null">
				#{cityId,jdbcType=INTEGER},
			</if>
			<if test="bankAccount != null">
				#{bankAccount,jdbcType=VARCHAR},
			</if>
			<if test="bankUserName != null">
				#{bankUserName,jdbcType=VARCHAR},
			</if>
			<if test="bankName != null">
				#{bankName,jdbcType=VARCHAR},
			</if>
			<if test="bankBranchName != null">
				#{bankBranchName,jdbcType=VARCHAR},
			</if>
			<if test="companyName != null">
				#{companyName,jdbcType=VARCHAR},
			</if>
			<if test="logoUrl != null">
				#{logoUrl,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.e3expo.e3.model.User">
		update te_user
		<set>
			<if test="jobNumber != null">
				job_number = #{jobNumber,jdbcType=VARCHAR},
			</if>
			<if test="mobile != null">
				mobile = #{mobile,jdbcType=VARCHAR},
			</if>
			<if test="password != null">
				password = #{password,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				email = #{email,jdbcType=VARCHAR},
			</if>
			<if test="createTime != null">
				create_time = #{createTime,jdbcType=BIGINT},
			</if>
			<if test="status != null">
				status = #{status,jdbcType=INTEGER},
			</if>
			<if test="isValid != null">
				is_valid = #{isValid,jdbcType=INTEGER},
			</if>
			<if test="updateTime != null">
				update_time = #{updateTime,jdbcType=BIGINT},
			</if>
			<if test="userType != null">
				user_type = #{userType,jdbcType=INTEGER},
			</if>
			<if test="qq != null">
				qq = #{qq,jdbcType=VARCHAR},
			</if>
			<if test="provinceId != null">
				province_id = #{provinceId,jdbcType=INTEGER},
			</if>
			<if test="cityId != null">
				city_id = #{cityId,jdbcType=INTEGER},
			</if>
			<if test="bankAccount != null">
				bank_account = #{bankAccount,jdbcType=VARCHAR},
			</if>
			<if test="bankUserName != null">
				bank_user_name = #{bankUserName,jdbcType=VARCHAR},
			</if>
			<if test="bankId != null">
				bank_id = #{bankId,jdbcType=INTEGER},
			</if>
			<if test="companyName != null">
				company_name = #{companyName,jdbcType=VARCHAR},
			</if>
			<if test="logoUrl != null">
				logo_url = #{logoUrl,jdbcType=VARCHAR},
			</if>
			<if test="auditRemark != null">
				audit_remark = #{auditRemark,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.e3expo.e3.model.User">
		update te_user
		set
		job_number = #{jobNumber,jdbcType=VARCHAR},
		mobile =
		#{mobile,jdbcType=VARCHAR},
		password = #{password,jdbcType=VARCHAR},
		email = #{email,jdbcType=VARCHAR},
		create_time =
		#{createTime,jdbcType=BIGINT},
		status = #{status,jdbcType=INTEGER},
		is_valid = #{isValid,jdbcType=INTEGER},
		update_time =
		#{updateTime,jdbcType=BIGINT},
		user_type =
		#{userType,jdbcType=INTEGER},
		qq = #{qq,jdbcType=VARCHAR},
		province_id =
		#{provinceId,jdbcType=INTEGER},
		city_id = #{cityId,jdbcType=INTEGER},
		bank_account = #{bankAccount,jdbcType=VARCHAR},
		bank_user_name =
		#{bankUserName,jdbcType=VARCHAR},
		bank_id = #{bankId,jdbcType=INTEGER},
		company_name = #{companyName,jdbcType=VARCHAR},
		logo_url =
		#{logoUrl,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>
	<!--后台管理根据筛选条件分页查询前台用户信息 te_user -->
	<select id="selectPagedListByAdmin" resultType="userView">
		SELECT
		a1.id,
		a1.job_number,
		a1.mobile,
		a1.email,
		a1.create_time,
		a1.`status`,
		a1.is_valid,
		a1.update_time,
		a1.user_type,
		a1.qq,
		a1.country_id,
		a1.province_id,
		a1.city_id,
		a1.bank_account,
		a1.bank_user_name,
		a1.bank_name,
		a1.bank_branch_name,
		a1.`name`,
		a1.company_name,
		a1.logo_url,
		a1.system_tag,
		a1.audit_remark,
		a1.working_years,
		a2.`name` AS country_name,
		a3.`name` AS province_name,
		a4.`name` AS city_name
		FROM
		te_user a1
		LEFT JOIN dic_country a2 ON
		a1.country_id = a2.id
		LEFT JOIN dic_province a3 ON a1.province_id =
		a3.id
		LEFT JOIN dic_city a4 ON a1.city_id = a4.id
		<where>
			<if test="userType != null">
				a1.user_type = #{userType}
			</if>
			<if test="countryId != null">
				AND a1.country_id = #{countryId}
			</if>
			<if test="provinceId != null">
				AND a1.province_id = #{provinceId}
			</if>
			<if test="cityId != null">
				AND a1.city_id = #{cityId}
			</if>
			<if test="status != null">
				AND a1.status = #{status}
			</if>
			<if test="isValid != null">
				AND a1.is_valid =#{isValid}
			</if>
			<if test="name != null">
				AND a1.name like CONCAT('%', #{name},'%')
			</if>
			<if test="mobile != null">
				AND a1.mobile like CONCAT('%', #{mobile},'%')
			</if>
			<if test="startTime != null">
				AND create_time <![CDATA[>=]]>
				#{startTime}
			</if>
			<if test="endTime != null">
				AND create_time <![CDATA[<=]]>
				#{endTime}
			</if>
		</where>
		<if test="sortby == null">
			order by create_time asc
		</if>
		<if test="offset != null and limit!=null">
			limit #{offset},#{limit}
		</if>
	</select>
	<!--后台管理根据筛选条件分页查询总的记录数 -->
	<select id="selectPagedTotalNumByAdmin" resultType="Integer">
		SELECT count(*)
		FROM
		te_user a1
		LEFT JOIN dic_country a2 ON a1.country_id
		= a2.id
		LEFT JOIN dic_province a3 ON a1.province_id = a3.id
		LEFT JOIN
		dic_city a4 ON a1.city_id = a4.id
		<where>
			<if test="userType != null">
				a1.user_type = #{userType}
			</if>
			<if test="countryId != null">
				AND a1.country_id = #{countryId}
			</if>
			<if test="provinceId != null">
				AND a1.province_id = #{provinceId}
			</if>
			<if test="cityId != null">
				AND a1.city_id = #{cityId}
			</if>
			<if test="status != null">
				AND a1.status = #{status}
			</if>
			<if test="isValid != null">
				AND a1.is_valid =#{isValid}
			</if>
			<if test="name != null">
				AND a1.name like CONCAT('%', #{name},'%')
			</if>
			<if test="mobile != null">
				AND a1.mobile like CONCAT('%', #{mobile},'%')
			</if>
			<if test="startTime != null">
				AND create_time <![CDATA[>=]]>
				#{startTime}
			</if>
			<if test="endTime != null">
				AND create_time <![CDATA[<=]]>
				#{endTime}
			</if>
		</where>
	</select>
	<!-- 后台获取设计师的详情，包含基础信息，国家，省份，城市，附件，审核记录等 -->
	<resultMap id="DesignerUserViewMap" type="designerUserView">
		<id property="id" column="id" />
		<result property="name" column="name" />
		<result property="mobile" column="mobile" />
		<result property="qq" column="qq" />
		<result property="email" column="email" />
		<result property="status" column="status" />
		<result property="statusRemark" column="status_remark" />
		<result property="bankName" column="bank_name" />
		<result property="bankAccount" column="bank_account" />
		<result property="bankBranch_name" column="bank_branch_name" />
		<result property="bankUserName" column="bank_user_name" />
		<result property="workingYears" column="working_years" />
		<result property="createTime" column="create_time" />
		<association property="country" javaType="country">
			<id property="id" column="country_id" />
			<result property="name" column="country_name" />
		</association>
		<association property="province" javaType="Province">
			<id property="id" column="province_id" />
			<result property="name" column="province_name" />
		</association>
		<association property="city" javaType="city">
			<id property="id" column="city_id" />
			<result property="name" column="city_name" />
		</association>
		<!-- ofType指定students集合中的对象类型 -->
		<collection property="images" ofType="userInfoFile">
			<id property="id" column="file_id" />
			<result property="fileName" column="file_name" />
			<result property="filePath" column="file_path" />
			<result property="fileType" column="file_type" />
		</collection>
		<!-- ofType指定students集合中的对象类型 -->
		<collection property="userRemarkLogs" ofType="userRemarkLog">
			<id property="id" column="remark_id" />
			<result property="remark" column="remark" />
			<result property="createTime" column="audit_create_time" />
			<association property="osUser" javaType="osUser">
				<id property="id" column="admin_user_id" />
				<result property="name" column="admin_user_name" />
			</association>
		</collection>
	</resultMap>
	<select id="getDesignerUserView" resultMap="DesignerUserViewMap">
		SELECT
		a1.id,a1.`name`,a1.mobile,a1.qq,a1.email,a1.`status`,a1.status_remark,a1.bank_name,a1.bank_account,a1.bank_branch_name,a1.bank_user_name,a1.working_years,a1.create_time,
		a1.country_id,a1.province_id,a1.city_id,
		a2.`name` as
		country_name,a3.`name` as province_name,a4.`name` as
		city_name,
		a5.id as
		file_id,a5.file_name,a5.file_path,a5.file_type,
		a6.id as
		remark_id,a6.remark,a6.create_time as audit_create_time,
		a7.id as
		admin_user_id, a7.`name` as admin_user_name
		FROM
		te_user a1
		LEFT JOIN
		dic_country a2 ON
		a1.country_id
		= a2.id
		LEFT JOIN
		dic_province a3 ON
		a1.province_id =
		a3.id
		LEFT JOIN dic_city a4 ON
		a1.city_id = a4.id
		LEFT
		JOIN te_user_info_file a5 on a1.id=a5.user_id
		LEFT JOIN
		te_user_remark_log a6 on a1.id=a5.user_id
		LEFT JOIN te_os_user
		a7 on
		a6.admin_user_id=a7.id
		where a1.id=#{userId}
	</select>
	<!-- ======================以上用户管理================================================================= -->
	<!-- ======================以下用户审核================================================================= -->
	<!-- 用户审核列表 -->
	<select id="selectAuditPagedListByAdmin" resultType="userAuditView">
		SELECT
		a1.id,
		a1.user_id,
		a1.job_number,
		a1.mobile,
		a1.email,
		a1.create_time,
		a1.`status`,
		a1.is_valid,
		a1.update_time,
		a1.user_type,
		a1.qq,
		a1.country_id,
		a1.province_id,
		a1.city_id,
		a1.bank_account,
		a1.bank_user_name,
		a1.bank_name,
		a1.bank_branch_name,
		a1.`name`,
		a1.company_name,
		a1.logo_url,
		a1.system_tag,
		a1.audit_remark,
		a1.working_years,
		a2.`name` AS country_name,
		a3.`name` AS province_name,
		a4.`name` AS city_name
		FROM
		te_user_audit a1
		LEFT JOIN dic_country a2 ON
		a1.country_id = a2.id
		LEFT JOIN dic_province a3 ON a1.province_id =
		a3.id
		LEFT JOIN dic_city a4 ON a1.city_id = a4.id
		<where>
			<if test="userType != null">
				a1.user_type = #{userType}
			</if>
			<if test="countryId != null">
				AND a1.country_id = #{countryId}
			</if>
			<if test="provinceId != null">
				AND a1.province_id = #{provinceId}
			</if>
			<if test="cityId != null">
				AND a1.city_id = #{cityId}
			</if>
			<if test="status != null">
				AND a1.status = #{status}
			</if>
			<if test="isValid != null">
				AND a1.is_valid =#{isValid}
			</if>
			<if test="name != null">
				AND a1.name like CONCAT('%', #{name},'%')
			</if>
			<if test="mobile != null">
				AND a1.mobile like CONCAT('%', #{mobile},'%')
			</if>
			<if test="startTime != null">
				AND create_time <![CDATA[>=]]>
				#{startTime}
			</if>
			<if test="endTime != null">
				AND create_time <![CDATA[<=]]>
				#{endTime}
			</if>
		</where>
		<if test="sortby == null">
			order by create_time asc
		</if>
		<if test="offset != null and limit!=null">
			limit #{offset},#{limit}
		</if>
	</select>
	<!--后台管理根据筛选条件分页查询总的记录数 -->
	<select id="selectAuditPagedTotalNumByAdmin" resultType="Integer">
		SELECT count(*)
		FROM
		te_user_audit a1
		LEFT JOIN dic_country a2 ON
		a1.country_id
		= a2.id
		LEFT JOIN dic_province a3 ON a1.province_id =
		a3.id
		LEFT JOIN
		dic_city a4 ON a1.city_id = a4.id
		<where>
			<if test="userType != null">
				a1.user_type = #{userType}
			</if>
			<if test="countryId != null">
				AND a1.country_id = #{countryId}
			</if>
			<if test="provinceId != null">
				AND a1.province_id = #{provinceId}
			</if>
			<if test="cityId != null">
				AND a1.city_id = #{cityId}
			</if>
			<if test="status != null">
				AND a1.status = #{status}
			</if>
			<if test="isValid != null">
				AND a1.is_valid =#{isValid}
			</if>
			<if test="name != null">
				AND a1.name like CONCAT('%', #{name},'%')
			</if>
			<if test="mobile != null">
				AND a1.mobile like CONCAT('%', #{mobile},'%')
			</if>
			<if test="startTime != null">
				AND create_time <![CDATA[>=]]>
				#{startTime}
			</if>
			<if test="endTime != null">
				AND create_time <![CDATA[<=]]>
				#{endTime}
			</if>
		</where>
	</select>
	<!-- 获取用户审核的资料详情 -->
	<resultMap id="userAuditDetailViewMap" type="userAuditDetailView">
		<id property="id" column="id" />
		<result property="userId" column="user_id" />
		<result property="name" column="name" />
		<result property="mobile" column="mobile" />
		<result property="qq" column="qq" />
		<result property="email" column="email" />
		<result property="status" column="status" />
		<result property="statusRemark" column="status_remark" />
		<result property="bankName" column="bank_name" />
		<result property="bankAccount" column="bank_account" />
		<result property="bankBranchName" column="bank_branch_name" />
		<result property="bankUserName" column="bank_user_name" />
		<result property="workingYears" column="working_years" />
		<result property="createTime" column="create_time" />
		<association property="country" javaType="country">
			<id property="id" column="country_id" />
			<result property="name" column="country_name" />
		</association>
		<association property="province" javaType="Province">
			<id property="id" column="province_id" />
			<result property="name" column="province_name" />
		</association>
		<association property="city" javaType="city">
			<id property="id" column="city_id" />
			<result property="name" column="city_name" />
		</association>
		<!-- ofType指定students集合中的对象类型 -->
		<collection property="images" ofType="userAuditFile">
			<id property="id" column="file_id" />
			<result property="fileName" column="file_name" />
			<result property="filePath" column="file_path" />
			<result property="fileType" column="file_type" />
			<result property="userAuditId" column="user_audit_id" />
		</collection>
		<!-- ofType指定students集合中的对象类型 -->
		<collection property="userAuditRemarkLogs" ofType="userAuditRemarkLog">
			<id property="id" column="remark_id" />
			<result property="remark" column="remark" />
			<result property="createTime" column="audit_create_time" />
			<association property="osUser" javaType="osUser">
				<id property="id" column="admin_user_id" />
				<result property="name" column="admin_user_name" />
			</association>
		</collection>
	</resultMap>
	<select id="getUserAuditDetailView" parameterType="java.lang.Integer" resultMap="userAuditDetailViewMap">
		SELECT
		a1.id,a1.user_id,a1.`name`,a1.mobile,a1.qq,a1.email,a1.`status`,a1.status_remark,a1.bank_name,a1.bank_account,a1.bank_branch_name,a1.bank_user_name,a1.working_years,a1.create_time,a1.update_time,a1.country_id,a1.province_id,a1.city_id,
		a2.`name` as country_name,
		a3.`name` as province_name,
		a4.`name` as city_name,
		a5.id as
		file_id,a5.user_audit_id,a5.file_name,a5.file_path,a5.file_type,
		a6.id
		as remark_id,a6.remark,a6.create_time as audit_create_time,
		a7.id as
		admin_user_id, a7.`name` as admin_user_name
		FROM
		te_user_audit a1
		LEFT
		JOIN dic_country a2 ON a1.country_id=a2.id
		LEFT JOIN dic_province a3 ON
		a1.province_id=a3.id
		LEFT JOIN dic_city a4 ON a1.city_id = a4.id
		LEFT
		JOIN te_user_audit_file a5 on a1.id=a5.user_audit_id
		LEFT JOIN
		te_user_audit_remark_log a6 on a1.id=a6.user_audit_id
		LEFT JOIN
		te_os_user a7 on a6.admin_user_id=a7.id
		where a1.id=#{userAuditId}
	</select>
</mapper>